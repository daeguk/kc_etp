<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="EtpRegister">  
    <!--
    * etp 신청현황조회
    * 
    -->
<select id="selectEtpApplyList" >
<![CDATA[
SELECT a.*, 
        (select inst_nm from m001uetpinstcode where inst_cd = a.inst_cd limit 1) inst_nm, 
        (select m_cd_nm from m001uetpcode where l_cd= '002' and m_cd = a.isin_stat_cd) m_cd_nm,
        timestampdiff(day,req_date,now()) lapse_date,
        timestampdiff(day,ifnull(list_date,"29991231")  ,now()) list_lapse_date, 
        ifnull(a.ridx_dist_sym_code,a.idx_sym_code) basic_idx,
        case a.kor_for_type
        when "K" then "국내"
        when "F" then "해외"        
        else ""
        end kor_for_type_name 
        from m001uetpmaster a
        WHERE (a.list_date    >=   current_date( )  or      a.list_date is null) 
        and a.isin_stat_cd != "0009" 
 ]]>
        <if test=" userType == '0001' "> 
 <![CDATA[
        and    a.inst_cd = #{instCd} 
 ]]>
       </if> 
       order by a.seq asc
   
</select>

<select id="getEtpApplyDistCnt">
<![CDATA[
       select count(1)  distCnt from m001uetpmaster where (list_date >=   current_date( )  or   list_date is null  )
]]>
       <if test=" userType == '0001' "> 
 <![CDATA[
        and    a.inst_cd = #{instCd} 
 ]]>
       </if> 
        and idx_dis_yn = 'y' and isin_stat_cd != '0009'
</select>

</mapper>