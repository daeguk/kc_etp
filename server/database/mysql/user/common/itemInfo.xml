<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="common.item">  
    <!--
    * 마켓 정보의 구성 기본 정보
    -->
    <select id="getFavorItemInfo">
        SELECT ITEM.ITEM_SEQ 
                ,ITEM.GUBUN
                ,ITEM.ITEM_CD
                ,ITEM.F16002
                ,ITEM.MARKET_ID
            FROM (SELECT A.ITEM_SEQ 
                        ,A.GUBUN
                        ,A.TYPE_CD 
                        ,A.INST_CD
                        ,A.EMAIL
                        ,A.F16012 AS ITEM_CD
                        ,B.F16002
                        ,'' AS MARKET_ID
                FROM tm_favor_item A
                INNER JOIN td_etp_basic B
                    ON A.F16012 = B.F16012
                AND A.gubun = '1'
                UNION ALL 
                SELECT A.ITEM_SEQ 
                    ,A.GUBUN
                    ,A.TYPE_CD 
                    ,A.INST_CD
                    ,A.EMAIL
                    ,A.F16013 AS ITEM_CD
                    ,B.F16002
                    ,B.MARKET_ID
                FROM tm_favor_item A
                INNER JOIN td_index_basic B
                ON A.F16013 = B.F16013
                AND A.market_id = B.market_id
                AND A.gubun = '2') ITEM
            WHERE ITEM.TYPE_CD = #{type_cd}
            AND ITEM.INST_CD = #{inst_cd}
            AND ITEM.EMAIL = #{user_id}
        ORDER BY ITEM.ITEM_SEQ 
    </select>
  
    <delete id="deleteFavorItem">
        DELETE FROM tm_favor_item
         WHERE TYPE_CD = #{type_cd}
           AND INST_CD =  #{inst_cd}
           AND EMAIL = #{user_id}
           AND ITEM_SEQ = #{item_seq}
    </delete>



    <insert id="insertFavorItem">
        INSERT INTO tm_favor_item
            (type_cd
            ,inst_cd
            ,email
            ,gubun
            ,F16012
            ,F16013
            ,market_id
            ,large_type
            ,middle_type)
            VALUES
            (
            #{type_cd}
            ,#{inst_cd}
            ,#{user_id}
            ,#{gubun}
            ,#{F16012}
            ,#{F16013}
            ,#{market_id}
            ,#{large_type}
            ,#{middle_type})

    </insert>


    <select id="getTodayIntraInfo">
        SELECT concat(substr(lpad(B.F20004,8, '0'), 1, 2), ':',substr(lpad(B.F20004,8, '0'), 3, 2), ':',substr(lpad(B.F20004,8, '0'), 5, 2)) AS trd_his
               ,DATE_FORMAT(B.F20044, "%Y.%m.%d") as trd_dd
		       ,B.F20008 as close_idx
        FROM td_index_basic A, 
            td_index_intra B
        WHERE A.F16013 = B.F16013
        AND A.MARKET_ID = B.MARKET_ID
        AND A.F16013 = #{f16013}
        AND A.MARKET_ID = #{market_id}
        AND DATE_FORMAT(B.F20044, "%Y.%m.%d") = DATE_FORMAT('20190410', "%Y.%m.%d")
        ORDER BY B.F20044 desc
    </select>

</mapper>