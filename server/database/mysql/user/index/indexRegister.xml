<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="index">  
  <select id="indexSummaryLately">
      SELECT BAS.F16013
            ,BAS.F16002
            ,BAS.LARGE_TYPE
            ,BAS.MIDDLE_TYPE
            ,HIS.F16013
            ,HIS.F12506
            ,HIS.F15009
            ,HIS.F15010
            ,HIS.F15011
            ,HIS.F15001
            ,HIS.F15472
            ,HIS.F15006
            ,HIS.F15004
            ,HIS.F15015
            ,HIS.F15023 
        FROM (SELECT * 
                FROM kc_etp.td_index_basic
                WHERE F16013 = (SELECT MAX(F16013)
                                    FROM kc_etp.td_index_basic
                                    WHERE large_type='FNGUIDE'
                                )
                ) BAS,
                kc_etp.td_index_history HIS
        WHERE BAS.F16013 = HIS.F16013
        ORDER BY HIS.F12506 DESC
        limit 0, 1

  </select>

  <select id="indexReqList">
      SELECT BAS.F16002
            ,BAS.F16013  
            ,REQ.INST_NAME
            ,date_format(REQ.REG_TIME, '%Y-%m-%d') REG_TIME
            ,REQ.REQ_FLAG
            ,REQ.REG_ID
        FROM td_index_basic BAS, 
            (SELECT A.*, B.INST_NAME 
          FROM tm_index_req A,
                    tm_domain_mast B
          WHERE A.INST_CD = B.INST_CD) REQ	
      WHERE BAS.F16013 = REQ.JISU_ID
        AND REQ.REQ_FLAG = '1'  
  </select>

    <!--
    * 이미 등록된 지수ID 가 존재하는지 확인한다.
    * 2019-04-02  bkLove(촤병국)
    -->
    <select id="getJisuDuplCheck">
        SELECT  COUNT(1)   AS  cnt
          FROM  tm_jisu_mast
         WHERE  tm_jisu_mast.jisu_id    =   #{jisu_id}
    </select>

    <!--
    * [tm_jisu_file] 테이블에 저장한다.
    * 2019-04-02  bkLove(촤병국)
    -->
    <insert     id="saveTmJisuFile">
        INSERT  INTO    tm_jisu_file 
        ( 
                org_file_name
            ,   save_file_name
            ,   file_size
            ,   mime_type
            ,   gubun

            ,   reg_id 
            ,   reg_time 
        ) 
        VALUES 
        ( 
                #{org_file_name}
            ,   #{save_file_name}
            ,   #{file_size}
            ,   #{mime_type}
            ,   #{gubun}

            ,   #{user_id}
            ,   now() 
        )
    </insert>

    <!--
    * [tm_jisu_temp_upload] 테이블에 저장한다.
    * 2019-04-02  bkLove(촤병국)
    -->
    <insert     id="saveTmJisuTempUpload">
        INSERT  INTO    tm_jisu_temp_upload 
        ( 
                file_id
            ,   row_no
            ,   col01
            ,   col02
            ,   col03
            ,   col04
            ,   col05

            ,   reg_id 
            ,   reg_time 
        ) 
        VALUES 
        ( 
                #{file_id}
            ,   #{row_no}
            ,   #{col01}
            ,   #{col02}
            ,   #{col03}
            ,   #{col04}
            ,   #{col05}

            ,   #{user_id}
            ,   now() 
        )
    </insert>    

    <!--
    * [tm_jisu_mast] 테이블에 저장한다.
    * 2019-04-02  bkLove(촤병국)
    -->
    <insert     id="saveTmJisuMast">
        INSERT  INTO    tm_jisu_mast 
        ( 
                jisu_id 

            ,   jisu_kor_nm 
            ,   jisu_eng_nm 
            ,   jisu_summary 
            ,   base_jisu 
            ,   base_date 
            ,   req_content 

            ,   reg_id 
            ,   reg_time 
            ,   upd_id 
            ,   upd_time 
        ) 
        VALUES 
        ( 
                #{jisu_id}

            ,   #{jisu_kor_nm}
            ,   #{jisu_eng_nm}
            ,   #{jisu_summary}
            ,   #{base_jisu}
            ,   REPLACE( #{base_date}, '-', '' ) 
            ,   #{req_content}

            ,   #{user_id}
            ,   now() 
            ,   #{user_id}
            ,   now() 
        )
    </insert>

</mapper>