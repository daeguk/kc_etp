<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="indexDetail">  

    <!--
    * 지수종목상세 정보를 조회한다. ( 지수관리 -> 지수종목상세 탭 클릭시 )
    * 2019-04-16  bkLove(촤병국)
    -->
    <select id="getIndexJongmokList">
    <![CDATA[
        SELECT      base.code                           AS  code
                ,   base.name                           AS  name

                ,   base.base_prc                       AS  base_prc
                ,   base.shrs                           AS  shrs
                ,   base.float_rto                      AS  float_rto
                ,   base.ceilling_rto                   AS  ceilling_rto
                ,   base.factor_rto                     AS  factor_rto
          FROM  (
                    SELECT      'code01'                AS  code
                            ,   'name01'                AS  name
                            
                            ,   1                       AS  base_prc
                            ,   2                       AS  shrs
                            ,   3                       AS  float_rto
                            ,   4                       AS  ceilling_rto
                            ,   5                       AS  factor_rto

                    UNION   ALL

                    SELECT      'code02'                AS  code
                            ,   'name02'                AS  name
                            
                            ,   11                      AS  base_prc
                            ,   22                      AS  shrs
                            ,   33                      AS  float_rto
                            ,   44                      AS  ceilling_rto
                            ,   55                      AS  factor_rto
                )       base

         WHERE  1 = 1
    ]]>
        <if test= 'searchData != null  and  searchData != "" ' >
    <![CDATA[
           AND  (       base.code               LIKE    #{searchData}
                    OR  base.name               LIKE    #{searchData}
                )
    ]]>
        </if>
    </select>


    <!--
    * 검색영역에 일치하는 지수정보를 조회한다. ( 지수관리 -> 지수종목상세 ->  quick 메뉴 -> 검색영역 )
    * 2019-04-16  bkLove(촤병국)
    -->
    <select id="getIndexList">
    <![CDATA[
        SELECT      base.f12506                         AS  f12506                  /* 입회일 */
                ,   base.f16013                         AS  f16013                  /* 단축코드 */
                ,   base.f16002                         AS  f16002                  /* 한글종목명 */
                ,   base.f15009                         AS  f15009                  /* 시가 */
                ,   base.f15010                         AS  f15010                  /* 고가 */
                ,   base.f15011                         AS  f15011                  /* 저가 */
                ,   base.f15001                         AS  f15001                  /* 현재가 */
                ,   base.f15007                         AS  f15007                  /* 기준가 */
                ,   base.f15015                         AS  f15015                  /* 거래량 */
                ,   base.f15023                         AS  f15023                  /* 거래대금 */
                ,   base.f15472                         AS  f15472                  /* 대비 */
                ,   base.f15004                         AS  f15004                  /* 등락율 */
                ,   base.f15006                         AS  f15006                  /* 등락구분(1:상한/2:상승/3:보합/4:하한/5:하락/6:기세상한/7:기세상승/8:기세하한/9:기세하락) */
                ,   base.f15028                         AS  f15028                  /* 시가총액 */
                ,   base.large_type                     AS  large_type              /* 지수대분류(FNGUIDE, KRX, KIS, KAP) */
                ,   base.middle_type                    AS  middle_type             /* 지수중분류(FNGUIDE, WISEFN) */
                ,   base.market_id                      AS  market_id               /* 시장 ID */
                ,   base.std_index                      AS  std_index               /* 기준지수 */
                ,   base.std_date                       AS  std_date                /* 기준일 */
                ,   base.anno_date                      AS  anno_date               /* 발표일 */
                ,   base.index_cal_method               AS  index_cal_method        /* 지수산출방식 */
                ,   base.std_capital                    AS  std_capital             /* 기준시가총액 */
                ,   base.fixed_cash                     AS  fixed_cash              /* 고정현금 */
                ,   base.flowrate_yn                    AS  flowrate_yn             /* 유동비율적용여부 */

          FROM  (
                    SELECT      CASE    WHEN    td_index_basic.f16013   LIKE    '60___'                     /* 단축코드 */
                                        THEN    CONCAT( 'MFI' , SUBSTR( td_index_basic.f16013, -3 ) )
                                
                                        WHEN    td_index_basic.f16013   LIKE    '62___'                     /* 단축코드 */
                                        THEN    CONCAT( 'WFN' , SUBSTR( td_index_basic.f16013, -3 ) )
                                END                     AS  up_code
                                
                            ,   td_index_basic.*

                      FROM  td_index_basic
                    
                     WHERE  1 = 1
                       AND  td_index_basic.large_type   =   'FNGUIDE'                       /* 지수대분류(FNGUIDE, KRX, KIS, KAP) */

                )       base
            
         WHERE	EXISTS
                (
                    SELECT	1
                      FROM  m168uidxmap
                     WHERE  m168uidxmap.up_code	    =	base.up_code     	    /* 업종코드 */
                )
    ]]>
        <if test= 'searchData != null  and  searchData != "" ' >                
              AND	( 		    base.f16013			LIKE	CONCAT( '%' , #{searchData} , '%' )     /* 단축코드 */
                        OR	    base.f16002         LIKE	CONCAT( '%' , #{searchData} , '%' )     /* 한글종목명 */
                    )
        </if>

            ORDER	BY	base.f12506	DESC		    /* 입회일 */

    </select>

</mapper>